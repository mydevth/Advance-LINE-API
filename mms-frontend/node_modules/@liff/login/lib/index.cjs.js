"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@liff/consts"),i=require("@liff/logger"),r=require("@liff/util"),o=require("@liff/store"),t=require("@liff/server-api"),n=require("@liff/get-version"),f=require("@liff/is-sub-window"),l=require("@liff/is-in-client"),u=require("tiny-sha256"),s=require("@liff/hooks"),a=require("@liff/sub-window");function d(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var c=d(u);var g=function(){function u(){this.hooks={before:new s.SyncHook}}return Object.defineProperty(u.prototype,"name",{get:function(){return"login"},enumerable:!1,configurable:!0}),u.prototype.install=function(){return this.login.bind(this)},u.prototype.login=function(u){var s;this.hooks.before.call(u);var d,g=r.randomAlphaNumericString(43),p=(d=g,r.hexToBase64(c.default(d)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")),h=o.getConfig();if(!h||!h.liffId)throw r.createLiffError(e.INVALID_CONFIG,"You need to define `liffId` for liff.login()");var _={app_id:h.liffId,state:r.randomAlphaNumericString(12),response_type:"code",code_challenge_method:"S256",code_challenge:p,liff_sdk_version:n.getVersion()};u&&u.redirectUri&&(_.redirect_uri=u.redirectUri),f.isSubWindow()&&!l.isInClient()&&((null===(s=a.getMessageBus())||void 0===s?void 0:s.isReady())?_.redirect_uri=window.location.href:_.disable_auto_login="true"),o.setLoginTmp({codeVerifier:g});var b=t.getEndPoint("authorize")+"?"+r.qs.stringify(_);i.logger.debug("[Redirect] "+b),window.location.href=b},u}();exports.LoginModule=g;
